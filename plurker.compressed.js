function LOG(A){return false;}function openExternalURL(A){var B=new air.URLRequest(A);try{air.navigateToURL(B);}catch(C){}}var RequestCache=function(){var A={};return{add:function(D,B,C){A[D]=(typeof A[D]=="object")?A[D]:new Array();A[D].push({scope:B,callback:C});},get:function(B){return A[B];}};}();function gmdate(){var A=new Date();return[A.getUTCFullYear(),"-",A.getUTCMonth()+1,"-",A.getUTCDate(),"T",A.getUTCHours(),":",A.getUTCMinutes(),":",A.getUTCSeconds()].join("");}$(document).ready(function(){$("form#PlurkForm").hide();$("a").externalURL();$("*").each(function(A,B){B.oncontextmenu=function(){return false;};});});$(window).load(function(){window.externalParseJSON=document.getElementById("frameId").contentWindow.childSandboxBridge.parseJSON;});PLURK_PATHS={http_base:"http://www.plurk.com",login:"http://www.plurk.com/Users/login?redirect_page=main",getCompletion:"http://www.plurk.com/Users/getCompletion",fan_user:"http://www.plurk.com/Users/setFollowingTL",fan_get:"http://www.plurk.com/Friends/getFansByOffset",fans_friends_get:"http://www.plurk.com/Friends/getFriendsAndFansByOffset",plurk_add:"http://www.plurk.com/TimeLine/addPlurk",plurk_respond:"http://www.plurk.com/Responses/add",plurk_get:"http://www.plurk.com/TimeLine/getPlurks",plurk_get_responses:"http://www.plurk.com/Responses/get2",plurk_get_unread:"http://www.plurk.com/TimeLine/getUnreadPlurks",plurk_mute:"http://www.plurk.com/TimeLine/setMutePlurk",plurk_delete:"http://www.plurk.com/TimeLine/deletePlurk",notification:"http://www.plurk.com/Notifications",notification_accept:"http://www.plurk.com/Notifications/allow",notification_makefan:"http://www.plurk.com/Notifications/allowDontFollow",notification_deny:"http://www.plurk.com/Notifications/deny",friends_get:"http://www.plurk.com/Users/friends_get",friends_block:"http://www.plurk.com/Friends/blockUser",friends_remove_block:"http://www.plurk.com/Friends/removeBlock",friends_get_blocked:"http://www.plurk.com/Friends/getBlockedByOffset",user_get_info:"http://www.plurk.com/Users/fetchUserInfo",logout:"http://www.plurk.com/Users/logout"};var plurker=function(){return{start:function(){plurker.AppUpdater.check(plurker.user);},user:function(){$("div#Bottom").hide();plurker.user=new plurker.User(plurker.lang);},lang:function(){plurker.lang=new plurker.Lang(this.user.session.default_lang,plurker.messages);},messages:function(){$("span#Avatar").html(['<img src="http://avatars.plurk.com/',this.user.page.uid,'-medium.gif" /><span></span>'].join(""));this.menu=new air.NativeMenu();temp=this.menu.addItem(new air.NativeMenuItem(plurker.lang.read("Visit profile")));temp.data={action:"profile",uid:plurker.user.session.uid};temp=this.menu.addItem(new air.NativeMenuItem(plurker.lang.read("Sign out [%s]",this.user.page.nick_name)));temp.data={action:"logout"};for(var A=0;A<this.menu.items.length;A++){this.menu.items[A].addEventListener(air.Event.SELECT,function(B){$(B).stop();jQuery.later(plurker.Actions,1,B.target.data.action,B.target.data);});}$("span#Avatar")[0].addEventListener("contextmenu",function(B){plurker.menu.display(window.nativeWindow.stage,B.clientX,B.clientY);});$("span#Avatar")[0].addEventListener("click",function(B){plurker.menu.display(window.nativeWindow.stage,B.clientX,B.clientY);});$("form#PlurkForm select option").each(function(B,C){try{C.innerHTML=plurker.lang.read(C.value)||"";}catch(D){}});Chrome.onResize();window.nativeWindow.height=500;$("div#Bottom").show();$("form#LoginForm").hide();plurker.messages=new plurker.PlurkList(this.user.page.uid,plurker.display);},updateInterval:null,display:function(){this.updateInterval=setInterval(function(){plurker.messages.reload();},15000);this.messages.load();},menu:null};}();plurker.NickNameById=function(A){plurk.UserFactory.get(A,function(C,B){$(".userId"+B).html(C);});};plurker.menuItemSelectHandler=function(A){LOG(A);};plurker.UserFactory=function(){var A={};var B={};return{get:function(E,D,C){RequestCache.add(E,D,C);if(typeof A[E]!="object"&&RequestCache.get(E).length<2){var F=this;$.ajax({type:"POST",url:PLURK_PATHS.user_get_info,data:{user_id:E},success:function(H){H=H.split('new Date("').join('"').split('GMT")').join('GMT"');var G=externalParseJSON(H);var I=new plurker.UserInstance(E,G);F.save(E,I);I.get(C,D);}});return{nick_name:"..."};}else{if(typeof A[E]=="object"){return A[E].get(C,D);}else{return{nick_name:"..."};}}},getUserInstance:function(C){return A[C];},save:function(C,D){A[C]=D;},refresh:function(C){$.ajax({type:"POST",url:PLURK_PATHS.user_get_info,data:{user_id:C},success:function(E){E=E.split('new Date("').join('"').split('GMT")').join('GMT"');var D=externalParseJSON(E);plurker.UserFactory.getUserInstance(C).update(D);}});}};}();plurker.UserInstance=function(B,A){this.user_id=B;this.userData=A;this.menu=false;return this;};plurker.UserInstance.prototype.get=function(){if(typeof arguments[0]=="string"){return this.userData[arguments[0]];}else{if((typeof arguments[0]=="function"||typeof arguments[0]=="object")&&typeof arguments[1]=="object"){arguments[0].call(arguments[1],this.userData);if(RequestCache.get(this.user_id).length>0){var A=RequestCache.get(this.user_id);for(var B in A){A[B].callback.call(A[B].scope,this.userData);}}}}return this.userData;};plurker.UserInstance.prototype.update=function(A){this.userData=A;};plurker.UserInstance.prototype.getMenu=function(){var C=this;if(this.menu){delete this.menu;}this.userData.relationship=this.userData.relationship.split("_");for(var G in this.userData.relationship){this.userData.relationship[G]=this.userData.relationship[G].charAt(0).toUpperCase()+this.userData.relationship[G].substring(1);}this.userData.relationship=this.userData.relationship.join(" ");var F=new Date();F.setTime((new Date()).getTime()-(new Date(this.userData.date_of_birth)).getTime());var A,E;this.menu=new air.NativeMenu();A=this.menu.addItem(new air.NativeMenuItem(this.userData.full_name));A.enabled=false;A=this.menu.addItem(new air.NativeMenuItem([plurker.lang.read((this.userData.gender==1)?"male":"female").toLowerCase(),", ",plurker.lang.read("Age:").toLowerCase()," ",F.getFullYear()-1970,", ",plurker.lang.read(this.userData.relationship.toString()).toLowerCase()].join("")));A.enabled=false;A=this.menu.addItem(new air.NativeMenuItem(this.userData.location));A.enabled=false;this.menu.addItem(new air.NativeMenuItem("",true));A=this.menu.addItem(new air.NativeMenuItem(plurker.lang.read("Visit profile")));A.data={action:"profile",uid:this.userData.uid};this.menu.addItem(new air.NativeMenuItem("",true));if(this.userData.is_blocked==1){A=this.menu.addItem(new air.NativeMenuItem(plurker.lang.read("Unblock")));A.data={action:"unblock",uid:this.userData.uid};}else{A=this.menu.addItem(new air.NativeMenuItem(plurker.lang.read("Block")));A.data={action:"block",uid:this.userData.uid};}if(this.userData.are_friends){A=this.menu.addItem(new air.NativeMenuItem(plurker.lang.read("Remove %s as friend",this.userData.nick_name)));A.data={action:"remove",uid:this.userData.uid};}else{A=this.menu.addItem(new air.NativeMenuItem(plurker.lang.read("Add %s as friend",this.userData.nick_name)));A.data={action:"add",uid:this.userData.uid};}A=this.menu.addItem(new air.NativeMenuItem(plurker.lang.read("Don't follow %s plurks",this.userData.nick_name)));A.data={action:"nofollow",uid:this.userData.uid};for(var B=0;B<this.menu.items.length;B++){this.menu.items[B].addEventListener(air.Event.SELECT,C.menuEventParser);}var D=function(H){C.menu.display(window.nativeWindow.stage,H.clientX,H.clientY);};return this.menu;};plurker.UserInstance.prototype.menuEventParser=function(A){$(A).stop();jQuery.later(plurker.Actions,1,A.target.data.action,A.target.data);};plurker.Lang=function(B,C){plurker.user.element.find(".info").html("Getting language...").show();this.callBack=C;this.language={};var A=this;$.ajax({type:"GET",url:["http://www.plurk.com/i18n/",B,"/LC_MESSAGES/messages.js"].join(""),success:function(E){plurker.user.element.find(".info").html("Translating...").show();var D=E.replace("babel.Translations.load(","").replace(").install();","");D=externalParseJSON(D);A.language=D.messages;A.callBack.call(plurker);},error:function(){var F=air.File.applicationDirectory.resolvePath("lang_en.json");var D=new air.FileStream();D.open(F,air.FileMode.READ);var E=D.readUTFBytes(D.bytesAvailable);D.close();langObject=externalParseJSON(E);A.language=langObject.messages;A.callBack.call(plurker);}});};plurker.Lang.prototype.read=function(B){var A=(typeof this.language[B]=="string")?this.language[B]:B;if(typeof arguments[1]=="string"){A=A.split("%s").join(arguments[1]);}return A;};plurker.PlurkList=function(A){this.uid=A;this.cache={};var B=this;$("div#PlurkScroll,.jScrollPaneContainer").show();$("form#PlurkForm").show().submit(function(C){$(C).stop();B.write();}).find("input[type=submit]").click(function(C){$(C).stop();B.write();});this.load();};plurker.PlurkList.prototype.cacheWrite=function(B,A){this.cache[B]=A;};plurker.PlurkList.prototype.cacheRead=function(A){return this.cache[A]||false;};plurker.PlurkList.prototype.load=function(){var A=this;$.ajax({type:"POST",url:PLURK_PATHS.plurk_get,data:{user_id:this.uid},success:function(E){try{E=E.split('new Date("').join('"').split('GMT")').join('GMT"');var C=externalParseJSON(E);for(var B in C){A.add(C[B]);}plurker.Scroll();}catch(D){LOG(D);return false;}}});};plurker.PlurkList.prototype.add=function(A){this.cacheWrite(A.plurk_id,new plurker.Plurk(A,arguments[1]));};plurker.PlurkList.prototype.reload=function(){var A=this;$.ajax({type:"POST",url:PLURK_PATHS.plurk_get,data:{user_id:this.uid},success:function(E){try{E=E.split('new Date("').join('"').split('GMT")').join('GMT"');var C=externalParseJSON(E);for(var B in C){A.refresh(C[B]);}}catch(D){LOG(D);return false;}plurker.Scroll();}});};plurker.PlurkList.prototype.refresh=function(A){if(!this.cacheRead(A.plurk_id)){this.add(A,true);}else{this.cacheRead(A.plurk_id).refresh(A);}};plurker.PlurkList.prototype.write=function(){if($("form#PlurkForm input[type=text]").val()!=""){var A=this;$.ajax({type:"POST",url:PLURK_PATHS.plurk_add,data:{posted:gmdate(),qualifier:$("form#PlurkForm select").val(),content:$("form#PlurkForm input[type=text]").val(),lang:plurker.user.session.default_lang,uid:plurker.user.session.uid,no_comments:0},success:function(B){$("form#PlurkForm input[type=text]").val("");plurker.messages.reload();}});}};plurker.PlurkList.prototype.remove=function(A){this.cache[A]=null;delete this.cache[A];$("li#plurk"+A).remove();$.ajax({type:"POST",url:PLURK_PATHS.plurk_delete,data:{plurk_id:A},success:function(C){try{plurker.messages.reload();return true;}catch(B){LOG(B);return false;}}});};plurker.PlurkList.prototype.unload=function(){for(var A in this.cache){this.cache[A]=null;delete this.cache[A];$("li#plurk"+A).remove();}};function postedAgo(D){if(typeof D!="object"){D=new Date(D);}var B=new Date();var E=new Date(B.getFullYear(),B.getMonth(),B.getDate(),0,0,0);var A=Math.round((B.getTime()-D.getTime())/1000/60);var C=Math.round((E.getTime()-D.getTime())/1000/60);if(A<60){return A+" min ago";}else{if(A>60&&C<0){return Math.round(A/60)+" hours ago";}else{return[D.getFullYear(),"/",D.getMonth()+1,"/",D.getDate()," ",D.getHours(),":",D.getMinutes()].join("");}}}plurker.Plurk=function(data,is_prepend){this.data=data;this.data.posted=new Date(this.data.posted);this.owner=null;this.responseList={};var that=this;var content=['<li id="plurk',data.plurk_id,'">','<span class="minimage"><img src="http://avatars.plurk.com/',data.owner_id,'-small.gif" alt=""></span>','<div class="',(data.is_unread==0)?"unread":"",'">','<a href="#" class="user">',plurker.UserFactory.get(data.owner_id,this,this.getUser).nick_name,"</a> ","<em>",plurker.lang.read(data.qualifier)||"","</em> ",data.content,'<span class="responses ',(data.response_count>0)?"":"empty",'">',"<small>@ ",postedAgo(data.posted),"</small> #",(eval(data.response_count-data.responses_seen)>0)?['<strong class="count">',data.response_count,"</strong>"].join(""):['<span class="count">',data.response_count,"</span>"].join(""),"</span>","</div>",'<ul class="responses"></ul><span class="responseClose"></span>',"</li>"].join("");var position=false;$("ul#Plurks").children().each(function(i,s){var num=s.id.replace("plurk","");if(!position&&num<data.plurk_id){position=num;}});if(position){$("ul#Plurks li#plurk"+position).before(content);}else{$("ul#Plurks").append(content);}this.element=$("li#plurk"+data.plurk_id);this.setUpMenu(data.owner_id);this.element.find("span.responses").click(function(){if(!$(this).hasClass("open")){$(this).addClass("open");that.getResponses();}}).end().find("span.responseClose").click(function(){$(this).hide().parent().find("ul.responses").hide().end().find("span.responses").removeClass("open");plurker.Scroll();}).end().find("a:not(.user)").externalURL().end().find("ul.responses").hide();return this;};plurker.Plurk.prototype.getUser=function(A){this.owner=A;try{this.element.find(".user").html(this.owner.nick_name);}catch(B){}};plurker.Plurk.prototype.getResponses=function(){this.element.find("ul.responses li").remove();var A=this;$.ajax({type:"POST",url:PLURK_PATHS.plurk_get_responses,data:{plurk_id:this.data.plurk_id},success:function(E){try{var C=externalParseJSON(E);A.element.find("ul.responses, span.responseClose").show();for(var B in C.responses){try{A.responseList[C.responses[B].id]=new plurker.Response(A.element.find("ul.responses"),C.responses[B]);}catch(D){}}A.element.find("ul.responses").append(['<li class="add"><form><input type="text"  maxlength="140" /><input type="image" src="images/icon_add.gif" /></form></li>'].join(""));A.element.find("ul.responses li form").submit(function(F){$(F).stop();A.addResponse();}).end().find("ul.responses li form input[image]").click(function(F){$(F).stop();A.addResponse();}).end();}catch(D){LOG(D);return false;}plurker.Scroll();}});};plurker.Plurk.prototype.addResponse=function(){if(this.element.find("input[type=text]").val()!=""){var A=this;$.ajax({type:"POST",url:PLURK_PATHS.plurk_respond,data:{posted:gmdate(),qualifier:":",content:this.element.find("input[type=text]").val(),lang:plurker.user.session.default_lang,uid:plurker.user.session.uid,p_uid:this.data.owner_id,plurk_id:this.data.plurk_id},success:function(D){try{var B=externalParseJSON(D);A.responseList[B.object.id]=new plurker.Response(A.element.find("ul.responses"),B.object,true);A.element.find("input[type=text]").val("").end().find("span.responses .count").html(parseInt(A.element.find("span.responses .count").html(),10)+1);}catch(C){LOG(C);return false;}}});}};plurker.Plurk.prototype.refresh=function(data){this.data=data;var that=this;this.element.find("span.responses").html(["<small>@ ",postedAgo(data.posted),"</small> #",(eval(data.response_count-data.responses_seen)>0)?['<strong class="count">',data.response_count,"</strong>"].join(""):['<span class="count">',data.response_count,"</span>"].join("")].join(""));if(data.is_unread!=0){this.element.find("div").css("fontStyle","normal");}if(data.response_count>0){this.element.find("span.responses").removeClass("empty").click(function(){if(that.data.response_count>0&&!$(this).hasClass("open")){$(this).addClass("open");that.getResponses();}});}if(this.element.find("ul.responses li").length>0&&this.element.find("ul.responses li").length<data.response_count){this.refreshResponses();}};plurker.Plurk.prototype.refreshResponses=function(){this.element.find("ul.responses li").remove();var A=this;$.ajax({type:"POST",url:PLURK_PATHS.plurk_get_responses,data:{plurk_id:this.data.plurk_id},success:function(E){try{var C=externalParseJSON(E);for(var B in C.responses){A.responseList[C.responses[B].id]=new plurker.Response(A.element.find("ul.responses"),C.responses[B]);}A.element.find("ul.responses").append(['<li class="add"><form id="reponseAdd',C.responses[B].id,'"><input type="text" /><input type="image" src="images/icon_add.gif" /></form></li>'].join(""));}catch(D){LOG(D);return false;}}});};plurker.Plurk.prototype.setUpMenu=function(A){var A=A;var B=this;var C=function(E){$(E).stop();plurker.UserFactory.getUserInstance(A).getMenu();if(B.data.owner_id==plurker.user.session.uid){delete plurker.UserFactory.getUserInstance(A).menu;plurker.UserFactory.getUserInstance(A).menu=new air.NativeMenu();temp=plurker.UserFactory.getUserInstance(A).menu.addItem(new air.NativeMenuItem(plurker.lang.read("Delete")));temp.data={action:"del",plurk_id:B.data.plurk_id};for(var D=0;D<plurker.UserFactory.getUserInstance(A).menu.items.length;D++){plurker.UserFactory.getUserInstance(A).menu.items[D].addEventListener(air.Event.SELECT,function(F){$(F).stop();jQuery.later(plurker.Actions,1,F.target.data.action,F.target.data);});}}plurker.UserFactory.getUserInstance(A).menu.display(window.nativeWindow.stage,E.clientX,E.clientY);};this.element.find("a.user").listen("contextmenu",C).listen("click",C).end().find("span.minimage").listen("contextmenu",C).listen("click",C).end();};plurker.Response=function(A,C){this.data=C;this.data.posted=new Date(this.data.posted);this.owner={};var B=this;if(arguments[2]){A.find("li.add").before(['<li id="response',C.id,'"><a href="" class="user"></a><em></em></li>'].join(""));}else{A.append(['<li id="response',C.id,'"><a href="" class="user"></a><em></em></li>'].join(""));}this.element=$("li#response"+C.id);this.element.html(['<a href="" class="user">',plurker.UserFactory.get(C.user_id,this,this.getUser).nick_name,"</a> ","<em>",plurker.lang.read(C.qualifier),"</em> ",C.content].join(""));this.element.find("a").externalURL();this.setUpMenu(C.user_id);return this;};plurker.Response.prototype.getUser=function(A){this.owner=A;this.element.find(".user").html(A.nick_name);};plurker.Response.prototype.setUpMenu=function(A){var A=A;var B=this;var C=function(D){$(D).stop();plurker.UserFactory.getUserInstance(A).getMenu();if(B.data.owner_id==plurker.user.session.uid){delete plurker.UserFactory.getUserInstance(A).menu;plurker.UserFactory.getUserInstance(A).menu=new air.NativeMenu();}plurker.UserFactory.getUserInstance(A).menu.display(window.nativeWindow.stage,D.clientX,D.clientY);};this.element.find("a.user").listen("contextmenu",C).listen("click",C);};plurker.Actions=function(){function A(C,D){var E=(typeof arguments[2]=="function")?arguments[2]:false;$.ajax({type:"GET",url:C,data:D,success:function(G){try{if(E){E.call();}plurker.messages.reload();return true;}catch(F){LOG(F);return false;}}});}function B(C,D){var E=(typeof arguments[2]=="function")?arguments[2]:false;$.ajax({type:"POST",url:C,data:D,success:function(G){try{if(E){E.call();}plurker.messages.reload();return true;}catch(F){LOG(F);return false;}}});}return{logout:function(C){plurker.user.logout();plurker.messages.unload();clearInterval(plurker.updateInterval);delete plurker.messages;delete plurker.user;delete plurker.lang;Chrome.onResize();window.nativeWindow.height=300;$("div#Bottom,div#PlurkScroll,.jScrollPaneContainer,form#PlurkForm,.info,.error").hide();$("input:disabled:checked").removeAttr("disabled");$("form#LoginForm").show();},follow:function(C){B(PLURK_PATHS.fan_user,{friend_id:C.uid,value:1},function(){plurker.UserFactory.refresh(C.uid);});},nofollow:function(C){B(PLURK_PATHS.fan_user,{friend_id:C.uid,value:0},function(){plurker.UserFactory.refresh(C.uid);});},add:function(C){},remove:function(C){},block:function(C){A(PLURK_PATHS.friends_block,{block_uid:C.uid},function(){plurker.UserFactory.refresh(C.uid);});},unblock:function(C){B(PLURK_PATHS.friends_remove_block,{friend_id:C.uid},function(){plurker.UserFactory.refresh(C.uid);});},profile:function(C){LOG(C);plurker.UserFactory.get(C.uid,window,function(){openExternalURL("http://www.plurk.com/user/"+arguments[0].nick_name);});},del:function(C){plurker.messages.remove(C.plurk_id);}};}();plurker.FansFriends=function(A){plurker.user.element.find(".info").html("Loading friends...").show();$.ajax({type:"POST",url:PLURK_PATHS.fans_friends_get,data:{offset:0,user_id:A},success:function(E){plurker.user.element.find(".info").html("Parsing friends...").show();var D=externalParseJSON(E);var B={};for(var C in D){B[D[C].uid]=D[C];}plurker.user.fans=B;}});};plurker.User=function(A){var E=this;this.session=null;this.page=null;this.fans=null;this.callBack=A;this.logout();this.element=$("form#LoginForm");var D=air.EncryptedLocalStore.getItem("autoLogin");var C=air.EncryptedLocalStore.getItem("userName");var F=air.EncryptedLocalStore.getItem("userPass");if(C&&F&&D){var B=C.readUTFBytes(C.length);var G=F.readUTFBytes(F.length);this.element.find("input[name=name]").val(B);this.element.find("input[name=password]").val(G);this.element.find("input#Remember").attr("checked","chekced");this.element.find("input#AutoLogin").attr("checked","chekced");this.login(B,G);return this;}if(C&&F){this.element.find("input[name=name]").val(C.readUTFBytes(C.length));this.element.find("input[name=password]").val(F.readUTFBytes(F.length));this.element.find("input#Remember").attr("checked","chekced");$("input#AutoLogin").removeAttr("disabled");}this.element.submit(function(H){$(H).stop();E.submit();}).find("input[type=submit]").click(function(H){$(H).stop();E.submit();}).end().find("input#Remember").change(function(){if($(this).attr("checked")){$("input#AutoLogin").removeAttr("disabled");}else{$("input#AutoLogin").attr("disabled","disabled");}});return this;};plurker.User.prototype.submit=function(){this.element.find(".error").html("");this.login(this.element.find("input[name=name]").val(),this.element.find("input[name=password]").val());};plurker.User.prototype.save=function(){var A=new air.ByteArray();A.writeUTFBytes(this.element.find("input[name=name]").val());air.EncryptedLocalStore.setItem("userName",A);var B=new air.ByteArray();B.writeUTFBytes(this.element.find("input[name=password]").val());air.EncryptedLocalStore.setItem("userPass",B);};plurker.User.prototype.unsave=function(){air.EncryptedLocalStore.removeItem("userName");air.EncryptedLocalStore.removeItem("userPass");};plurker.User.prototype.setAutoLogin=function(A){if(A){var B=new air.ByteArray();B.writeUTFBytes("true");air.EncryptedLocalStore.setItem("autoLogin",B);}else{air.EncryptedLocalStore.removeItem("autoLogin");}};plurker.User.prototype.login=function(A,B){this.element.find(".info").html("Logging in...").show();var C=this;$.ajax({type:"POST",url:PLURK_PATHS.login,data:{nick_name:A,password:B},success:function(G){C.element.find(".info").html("Loading...").show();var D=/var GLOBAL = \{.*"uid": ([\d]+),.*\}/gim;var E=G.match(D);try{E=externalParseJSON(E[0].split(" = ")[1]);C.session=E.session_user;C.page=E.page_user;new plurker.FansFriends(C.session.uid);if(C.element.find("input#Remember").attr("checked")){C.save();}else{C.unsave();}if(C.element.find("input#AutoLogin").attr("checked")){C.setAutoLogin(true);}else{C.setAutoLogin(false);}C.callBack.call(plurker);}catch(F){LOG(F);E={};E.session_user=false;E.page_user=false;C.element.find(".error").html("Login error.").show();}}});};plurker.User.prototype.logout=function(){$.ajax({type:"POST",url:PLURK_PATHS.logout});};plurker.Scroll=function(){$("div#PlurkScroll").jScrollPane({showArrows:true,scrollbarWidth:17,arrowSize:21,scrollbarOnLeft:true});};plurker.AppUpdater=function(){var B={updaterURL:"http://nec.shell8.net/plurker/downloads/update.xml",updateOnStart:true};var D={titleUpdate:"New Update Available",confirmUpdate:"New version is available from plurker, do you want to install?\n\nDescription: \n",successUpdate:"Update is succesful, plurker now restarts...",errorUpdate:"Update failed :(",progressUpdate:"Updating...",yes:"Yes please!",no:"Nope, thx."},G={version:0,file:null},A={notes:null,version:0,file:null};var H=air.NativeApplication.nativeApplication.applicationDescriptor;var F=(new DOMParser()).parseFromString(H,"text/xml");G.version=parseFloat(F.getElementsByTagName("version")[0].firstChild.nodeValue,10);G.file=F.getElementsByTagName("filename")[0].firstChild.nodeValue;function E(){var J=this;var I=new XMLHttpRequest();I.onreadystatechange=function(){if(I.readyState===4){var L=I.responseXML;var K=L.getElementsByTagName("releasenotes")[0];if(typeof K==="object"&&K.firstChild){A.notes=K.firstChild.nodeValue;}var N=L.getElementsByTagName("latestversion")[0];if(typeof N==="object"&&N.firstChild){A.version=parseFloat(N.firstChild.nodeValue,10);}var M=L.getElementsByTagName("file")[0];if(typeof M==="object"&&M.firstChild){A.file=M.firstChild.nodeValue;}if(A.version>G.version){C();}else{plurker.AppUpdater.callback.call();}}};I.open("GET",B.updaterURL,true);I.send(null);}function C(){var I=this;if(confirm(D.confirmUpdate+A.notes)){var J={};J.start=function(){stream=new air.URLStream();stream.addEventListener(air.Event.COMPLETE,J.finish);stream.load(new air.URLRequest(A.file));};J.finish=function(){var K=new air.ByteArray();stream.readBytes(K,0,stream.bytesAvailable);updateFile=air.File.applicationStorageDirectory.resolvePath(G.file+".air");fileStream=new air.FileStream();fileStream.addEventListener(air.Event.CLOSE,J.preinstall);fileStream.openAsync(updateFile,air.FileMode.WRITE);fileStream.writeBytes(K,0,K.length);fileStream.close();};J.preinstall=function(){alert(D.successUpdate);J.install();};J.install=function(){var K=new air.Updater();K.update(updateFile,A.version.toString());};J.start();}else{plurker.AppUpdater.callback.call();}}return{callback:null,check:function(I){this.callback=I;E();},noaction:function(){return"noaction";},current:function(){return G;}};}();var Chrome=function(){$(document).ready(function(){Chrome.initialize();});return{unfocus:0,options:{exitOnClose:false,minimizable:true,maximizable:false,resizable:true,fadeInactive:false,alwaysInFront:false,fadeAnimStart:true},application:null,initialize:function(){window.chrome=this;$("div#Head").mousedown(function(){Chrome.move();});$("span#Close").click(function(){Chrome.close();});$("span#Minimize").click(function(){Chrome.minimize();});this.onResize();if(this.options.resizable){$("span#ResizeBottomRight").mousedown(function(){Chrome.resize("BR");});$("span#ResizeBottomLeft").mousedown(function(){Chrome.resize("BL");});$("span#ResizeTopLeft").mousedown(function(){Chrome.resize("TL");});$("span#ResizeTopRight").mousedown(function(){Chrome.resize("TR");});window.nativeWindow.addEventListener(air.Event.RESIZE,function(e){Chrome.onResize(e);});}window.nativeWindow.alwaysInFront=this.options.alwaysInFront;if(this.options.fadeInactive){$("body").mouseout(function(e){Chrome.getFocus();clearTimeout(Chrome.unfocus);Chrome.unfocus=$.later(Chrome,5000,"unFocus");});}this.application.call();$("body").css({opacity:"0.1"});window.nativeWindow.visible=true;if(this.options.fadeAnimStart){$("body").animate({opacity:"1"},300);}else{$("body").css({opacity:"1"});}},loader:function(_bool){if(_bool){$("div#Loader").show();}else{$("div#Loader").hide();}},move:function(){window.nativeWindow.startMove();},minimize:function(){window.nativeWindow.minimize();},close:function(){var that=this;$("body").animate({opacity:"0"},300,function(){var eExit=new air.Event(air.Event.EXITING,true,true);air.NativeApplication.nativeApplication.dispatchEvent(eExit);air.NativeApplication.nativeApplication.exit();});},resize:function(orientation){window.nativeWindow.startResize(orientation);},onResize:function(event){try{height=event.afterBounds.height;width=event.afterBounds.width;}catch(e){height=window.nativeWindow.height;width=window.nativeWindow.width;}$("body").css({height:eval(height-32)});$("div#WrapperShadow").css({height:eval(height-14),width:eval(width-10)});$("div#Wrapper").css({height:eval(height-24),width:eval(width-20)});$("form#PlurkForm input[type=text]").css({width:eval(width-85)});$(".jScrollPaneContainer").css({height:eval(height-145),width:eval(width-24)});$("div#PlurkScroll").css({height:eval(height-145),width:eval(width-32)});plurker.Scroll();}};}();